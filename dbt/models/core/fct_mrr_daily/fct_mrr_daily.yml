models:
  - name: fct_mrr_daily
    description: "Daily MRR snapshot per account with movement classification (grain: account_id + date)."
    columns:
      - name: account_id
        tests:
          - not_null
          - relationships:
              to: ref('dim_account')
              field: account_id

      - name: date
        tests:
          - not_null
          - relationships:
              to: ref('dim_date')
              field: date
      - name: prev_mrr
      - name: mrr
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
      - name: mrr_movement
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: -1000000
      - name: mrr_movement_type
        tests:
          - accepted_values:
              values: ['new','expansion','contraction','churn','reactivation','no_change']

    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns: ['account_id', 'date']
